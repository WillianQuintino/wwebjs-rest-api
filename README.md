# üöÄ WhatsApp Web.js API

> API REST completa para integra√ß√£o com WhatsApp Web usando Node.js, TypeScript, Express e whatsapp-web.js

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.3-blue)](https://www.typescriptlang.org/)
[![Node.js](https://img.shields.io/badge/Node.js-14+-green)](https://nodejs.org/)

## üìã √çndice

- [Sobre](#sobre)
- [Caracter√≠sticas](#caracter√≠sticas)
- [Arquitetura](#arquitetura)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Uso](#uso)
- [Documenta√ß√£o da API (Swagger)](#-documenta√ß√£o-da-api-swagger)
- [API Endpoints](#api-endpoints)
- [Estrutura do Projeto](#estrutura-do-projeto)
- [Tecnologias](#tecnologias)
- [Contribuindo](#contribuindo)
- [Licen√ßa](#licen√ßa)

## üéØ Sobre

Esta API fornece uma interface REST completa para interagir com o WhatsApp Web atrav√©s da biblioteca `whatsapp-web.js`. Foi constru√≠da seguindo os princ√≠pios de Clean Architecture, SOLID e boas pr√°ticas de desenvolvimento.

## ‚ú® Caracter√≠sticas

- üîê **M√∫ltiplas sess√µes**: Gerenciamento de m√∫ltiplas sess√µes simult√¢neas
- üí¨ **Mensagens**: Envio de texto, m√≠dia, localiza√ß√£o, enquetes
- üë• **Grupos**: Cria√ß√£o e gerenciamento completo de grupos
- üì± **Contatos**: Gerenciamento de contatos e valida√ß√£o de n√∫meros
- üé® **Perfil**: Customiza√ß√£o de perfil (nome, status, foto)
- üìä **Chats**: Gerenciamento de conversas (arquivar, fixar, silenciar)
- üîÑ **Eventos em tempo real**: WebSocket para eventos do WhatsApp
- üõ°Ô∏è **Seguran√ßa**: Helmet, CORS, valida√ß√µes
- üìù **Logs**: Sistema de logging com Winston
- üéØ **TypeScript**: Tipagem forte em todo o projeto
- üèóÔ∏è **Clean Architecture**: Separa√ß√£o de responsabilidades
- ‚úÖ **SOLID**: Princ√≠pios de design aplicados

## üèõÔ∏è Arquitetura

O projeto segue a arquitetura em camadas (Clean Architecture):

```
src/
‚îú‚îÄ‚îÄ config/          # Configura√ß√µes (env, logger, whatsapp)
‚îú‚îÄ‚îÄ models/          # Interfaces e tipos TypeScript
‚îú‚îÄ‚îÄ repositories/    # Camada de acesso a dados
‚îú‚îÄ‚îÄ services/        # L√≥gica de neg√≥cio
‚îú‚îÄ‚îÄ controllers/     # Controladores (handlers de requisi√ß√£o)
‚îú‚îÄ‚îÄ routes/          # Defini√ß√£o de rotas
‚îú‚îÄ‚îÄ middlewares/     # Middlewares (error handler, async handler)
‚îú‚îÄ‚îÄ utils/           # Utilit√°rios (validators, formatters, errors)
‚îú‚îÄ‚îÄ app.ts           # Configura√ß√£o do Express
‚îî‚îÄ‚îÄ server.ts        # Inicializa√ß√£o do servidor
```

### Princ√≠pios aplicados:

- **Single Responsibility**: Cada classe tem uma √∫nica responsabilidade
- **Open/Closed**: Extens√≠vel sem modificar c√≥digo existente
- **Liskov Substitution**: Interfaces bem definidas
- **Interface Segregation**: Interfaces espec√≠ficas e coesas
- **Dependency Inversion**: Depend√™ncias por abstra√ß√£o

## üì¶ Instala√ß√£o

```bash
# Clone o reposit√≥rio
git clone https://github.com/seu-usuario/api-wwebjs.git

# Entre na pasta
cd api-wwebjs

# Instale as depend√™ncias
npm install
```

## ‚öôÔ∏è Configura√ß√£o

1. Copie o arquivo de exemplo de vari√°veis de ambiente:

```bash
cp .env.example .env
```

2. Configure as vari√°veis de ambiente no arquivo `.env`:

```env
# Server Configuration
PORT=3000
NODE_ENV=development

# API Configuration
API_PREFIX=/api
API_VERSION=v1

# WhatsApp Configuration
SESSION_NAME=default
SESSION_PATH=./sessions
PUPPETEER_HEADLESS=true

# Security
API_KEY=your-secret-api-key-here
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
```

## üöÄ Uso

### Desenvolvimento

```bash
npm run dev
```

### Produ√ß√£o

```bash
# Build
npm run build

# Start
npm start
```

## üìÑ Documenta√ß√£o da API (Swagger)

Este projeto utiliza Swagger para gerar uma documenta√ß√£o da API interativa e f√°cil de usar.

Para acessar a documenta√ß√£o:

1. Inicie o servidor em modo de desenvolvimento:
   ```bash
   npm run dev
   ```
2. Abra seu navegador e acesse a seguinte URL:
   ```
   http://localhost:3000/docs
   ```

Voc√™ ver√° a interface do Swagger UI, onde poder√° explorar todos os endpoints, ver os par√¢metros necess√°rios, os corpos de requisi√ß√£o e at√© mesmo testar as chamadas de API diretamente pelo navegador.

## üì° API Endpoints

### Base URL

```
http://localhost:3000/api/v1
```

### Autentica√ß√£o de Sess√£o

#### Inicializar Sess√£o

```http
POST /sessions/:sessionId/init
```

Inicializa uma nova sess√£o do WhatsApp. Retorna QR Code para escaneamento.

**Resposta:**
```json
{
  "success": true,
  "data": {
    "sessionId": "default",
    "status": "INITIALIZING",
    "qrCode": "data:image/png;base64,..."
  },
  "message": "Session initialized successfully",
  "timestamp": "2025-10-01T00:00:00.000Z"
}
```

#### Obter Sess√£o

```http
GET /sessions/:sessionId
```

#### Listar Todas as Sess√µes

```http
GET /sessions
```

#### Destruir Sess√£o

```http
DELETE /sessions/:sessionId
```

#### Fazer Logout

```http
POST /sessions/:sessionId/logout
```

---

### Mensagens

#### Enviar Mensagem de Texto

```http
POST /sessions/:sessionId/messages/send
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "content": "Ol√°! Esta √© uma mensagem de teste.",
  "options": {
    "quotedMessageId": "optional_message_id",
    "mentions": ["5511888888888@c.us"]
  }
}
```

#### Enviar M√≠dia

```http
POST /sessions/:sessionId/messages/send-media
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "media": {
    "mimetype": "image/png",
    "data": "base64_encoded_data",
    "filename": "image.png"
  },
  "options": {
    "caption": "Legenda da imagem"
  }
}
```

#### Enviar Localiza√ß√£o

```http
POST /sessions/:sessionId/messages/send-location
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "latitude": -23.5505,
  "longitude": -46.6333,
  "name": "S√£o Paulo",
  "address": "S√£o Paulo, SP, Brasil"
}
```

#### Enviar Enquete

```http
POST /sessions/:sessionId/messages/send-poll
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "question": "Qual sua cor favorita?",
  "options": ["Azul", "Verde", "Vermelho"],
  "allowMultipleAnswers": false
}
```

#### Reagir a Mensagem

```http
POST /sessions/:sessionId/messages/react
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "messageId": "message_id_here",
  "emoji": "üëç"
}
```

#### Encaminhar Mensagem

```http
POST /sessions/:sessionId/messages/forward
```

#### Deletar Mensagem

```http
DELETE /sessions/:sessionId/messages
```

#### Editar Mensagem

```http
PUT /sessions/:sessionId/messages/edit
```

#### Buscar Mensagens

```http
GET /sessions/:sessionId/messages/:chatId?limit=50
```

#### Pesquisar Mensagens

```http
POST /sessions/:sessionId/messages/search
```

#### Baixar M√≠dia

```http
GET /sessions/:sessionId/messages/:chatId/:messageId/media
```

---

### Chats

#### Listar Todos os Chats

```http
GET /sessions/:sessionId/chats
```

#### Obter Chat Espec√≠fico

```http
GET /sessions/:sessionId/chats/:chatId
```

#### Arquivar/Desarquivar Chat

```http
POST /sessions/:sessionId/chats/archive
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "archive": true
}
```

#### Fixar/Desfixar Chat

```http
POST /sessions/:sessionId/chats/pin
```

#### Silenciar/Reativar Chat

```http
POST /sessions/:sessionId/chats/mute
```

**Body:**
```json
{
  "chatId": "5511999999999@c.us",
  "mute": true,
  "duration": 3600
}
```

#### Marcar Como N√£o Lido

```http
POST /sessions/:sessionId/chats/:chatId/mark-unread
```

#### Enviar Visto

```http
POST /sessions/:sessionId/chats/:chatId/send-seen
```

#### Enviar Estado "Digitando"

```http
POST /sessions/:sessionId/chats/:chatId/send-typing
```

#### Enviar Estado "Gravando √Åudio"

```http
POST /sessions/:sessionId/chats/:chatId/send-recording
```

#### Limpar Mensagens

```http
POST /sessions/:sessionId/chats/:chatId/clear
```

#### Deletar Chat

```http
DELETE /sessions/:sessionId/chats/:chatId
```

---

### Grupos

#### Criar Grupo

```http
POST /sessions/:sessionId/groups
```

**Body:**
```json
{
  "name": "Meu Grupo",
  "participantIds": [
    "5511999999999@c.us",
    "5511888888888@c.us"
  ]
}
```

#### Adicionar Participantes

```http
POST /sessions/:sessionId/groups/add-participants
```

#### Remover Participantes

```http
POST /sessions/:sessionId/groups/remove-participants
```

#### Promover a Admin

```http
POST /sessions/:sessionId/groups/promote-participants
```

#### Remover Admin

```http
POST /sessions/:sessionId/groups/demote-participants
```

#### Atualizar Nome do Grupo

```http
PUT /sessions/:sessionId/groups/subject
```

#### Atualizar Descri√ß√£o do Grupo

```http
PUT /sessions/:sessionId/groups/description
```

#### Atualizar Foto do Grupo

```http
PUT /sessions/:sessionId/groups/picture
```

#### Sair do Grupo

```http
POST /sessions/:sessionId/groups/:groupId/leave
```

#### Obter C√≥digo de Convite

```http
GET /sessions/:sessionId/groups/:groupId/invite-code
```

#### Revogar Convite

```http
POST /sessions/:sessionId/groups/:groupId/revoke-invite
```

#### Aceitar Convite

```http
POST /sessions/:sessionId/groups/accept-invite
```

---

### Contatos

#### Listar Todos os Contatos

```http
GET /sessions/:sessionId/contacts
```

#### Obter Contato Espec√≠fico

```http
GET /sessions/:sessionId/contacts/:contactId
```

#### Obter Foto de Perfil

```http
GET /sessions/:sessionId/contacts/:contactId/profile-pic
```

#### Obter Status/Sobre

```http
GET /sessions/:sessionId/contacts/:contactId/about
```

#### Obter Grupos em Comum

```http
GET /sessions/:sessionId/contacts/:contactId/common-groups
```

#### Bloquear Contato

```http
POST /sessions/:sessionId/contacts/:contactId/block
```

#### Desbloquear Contato

```http
POST /sessions/:sessionId/contacts/:contactId/unblock
```

#### Validar N√∫mero

```http
POST /sessions/:sessionId/contacts/validate-number
```

**Body:**
```json
{
  "number": "5511999999999"
}
```

#### Listar Contatos Bloqueados

```http
GET /sessions/:sessionId/contacts/blocked
```

#### Salvar Contato

```http
POST /sessions/:sessionId/contacts/save
```

---

### Perfil

#### Obter Perfil

```http
GET /sessions/:sessionId/profile
```

#### Atualizar Nome

```http
PUT /sessions/:sessionId/profile/name
```

#### Atualizar Status

```http
PUT /sessions/:sessionId/profile/status
```

#### Atualizar Foto

```http
PUT /sessions/:sessionId/profile/picture
```

#### Deletar Foto

```http
DELETE /sessions/:sessionId/profile/picture
```

#### Obter Status da Bateria

```http
GET /sessions/:sessionId/profile/battery
```

---

### Health Check

```http
GET /health
```

## üìÅ Estrutura do Projeto

```
api-wwebjs/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ env.ts                 # Vari√°veis de ambiente
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.ts              # Configura√ß√£o do Winston
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ whatsapp.ts            # Configura√ß√£o do WhatsApp
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IWhatsAppClient.ts     # Interfaces do cliente
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IMessage.ts            # Interfaces de mensagens
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IChat.ts               # Interfaces de chats
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IGroup.ts              # Interfaces de grupos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IContact.ts            # Interfaces de contatos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IProfile.ts            # Interfaces de perfil
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IResponse.ts           # Interfaces de resposta
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SessionRepository.ts   # Reposit√≥rio de sess√µes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WhatsAppClientService.ts  # Servi√ßo de clientes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageService.ts         # Servi√ßo de mensagens
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatService.ts            # Servi√ßo de chats
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GroupService.ts           # Servi√ßo de grupos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ContactService.ts         # Servi√ßo de contatos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileService.ts         # Servi√ßo de perfil
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientController.ts    # Controller de clientes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageController.ts   # Controller de mensagens
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # Demais controllers
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts              # Todas as rotas
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.ts       # Tratamento de erros
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asyncHandler.ts       # Handler ass√≠ncrono
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApiError.ts           # Classe de erros
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApiResponse.ts        # Classe de respostas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.ts         # Validadores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ formatters.ts         # Formatadores
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ app.ts                    # Configura√ß√£o do Express
‚îÇ   ‚îî‚îÄ‚îÄ server.ts                 # Servidor
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .eslintrc.json
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

## üõ†Ô∏è Tecnologias

- **Node.js** - Runtime JavaScript
- **TypeScript** - Superset JavaScript tipado
- **Express** - Framework web
- **whatsapp-web.js** - Biblioteca para WhatsApp Web
- **Puppeteer** - Controle de navegador headless
- **Winston** - Sistema de logs
- **Helmet** - Seguran√ßa HTTP
- **CORS** - Cross-Origin Resource Sharing
- **Morgan** - HTTP request logger
- **QRCode** - Gerador de QR Code

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Por favor, siga estas diretrizes:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## ‚ö†Ô∏è Avisos Importantes

1. **N√£o √© API Oficial**: Esta biblioteca usa engenharia reversa do WhatsApp Web
2. **Riscos**: O uso pode resultar em banimento tempor√°rio ou permanente
3. **Limite de Taxa**: WhatsApp tem limite de mensagens por minuto
4. **Status Online**: O cliente aparecer√° online enquanto conectado
5. **Sess√£o √önica**: Apenas uma sess√£o ativa por n√∫mero

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üë§ Autor

**Willian Quintino**

- GitHub: [@WillianQuintino](https://github.com/WillianQuintino)

## üôè Agradecimentos

- [whatsapp-web.js](https://github.com/pedroslopez/whatsapp-web.js)
- Comunidade Open Source

---

‚≠ê Se este projeto te ajudou, considere dar uma estrela!
